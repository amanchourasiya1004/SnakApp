{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search</title>
    <link rel="stylesheet" href="{% static 'css/search_single.css' %}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Muli" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

</head>
<body>
    
    <div class='search-container d-flex justify-content-center'>
        <div class="iconwrap d-flex">
            <i class="fa fa-search align-self-center" aria-hidden="true"></i>
            <input type="text" placeholder="Search by Username" class="align-self-center search-res" id="search">
        </div>
    </div>
    <div class="caption">
        Search results
    </div>
    <div class="search-result">
        <!-- <div class="results d-flex">
            <span class="user-icon">
                <img class="rounded-circle" src="/home/captain/chatrooms/authenticate/static/images/avatar-dhg.png">
            </span>
            <div class="user-data align-self-start">
                <div class="user-name">Captain</div>
                <div class="mood">Hey there I am using SnakApp</div>
            </div>
        </div>
        <div class="results d-flex">
            <span class="user-icon">
                <img class="rounded-circle" src="/home/captain/chatrooms/authenticate/static/images/avatar-dhg.png">
            </span>
            <div class="user-data align-self-start">
                <div class="user-name">Captain</div>
                <div class="mood">Hey there I am using SnakApp</div>
            </div>
        </div> -->
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        const me = "{{me|escapejs}}";
        console.log(me);
        function personal(e){
            console.log("running");
            var otheruser = $($(e).children($('.user-name'))[0]).text();
            window.location.pathname = '/main/personalchat/' + otheruser + '/';
        }
        $('#search').keyup(function(){
            var name;
            const query = $(this).val();
            $.ajax({
                type : 'GET',
                url : "{% url 'SearchView' %}",
                data : {'search' : query},
                success : function(response){
                    var queryset = JSON.parse(response['result']);
                    $('.search-result').empty();
                    for(var i = 0; i < queryset.length; i++){
                        name = queryset[i]['fields']['username'];
                        if(name == me){
                            console.log(me);
                            continue;
                        }
                        $('.search-result').append(
                            '<div class="results d-flex"><span class="user-icon"><img class="rounded-circle" src="/home/captain/chatrooms/authenticate/static/images/avatar-dhg.png"></span><div class="user-data align-self-start" onclick="personal(this)"><div class="user-name">' + name + '</div><div class="mood">Hey there I am using SnakApp</div></div></div>'
                        );
                    } onclick="personal(this)"
                    if(response['length'] == 0){
                        $('.search-result').append(
                            '<div class="no-users">No Users found with this username</div>' 
                        );
                        console.log('No items Matched!!');
                    }
                },
                error : function(response){
                    console.log("something bad");
                }
            });
        });
        
    </script>
</body>
</html>