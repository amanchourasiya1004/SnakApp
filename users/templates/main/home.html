{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Muli" />
    <link rel="stylesheet" href="{% static 'css/home.css' %}">
    <link rel="stylesheet" href="{% static 'css/home_2.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
    <title>Main</title>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-panel">
            <div class="userinformation">
                <div class="greenbox">
                    <div class="user text-center">{{nickname}}</div>
                </div>
                <div class="username">{{fullname}}</div>
                <div class="email-sidebar">{{email}}</div>
            </div>
            <div class="utilities">
                <div class="options newgroup">Create a group</div>
                <div class="options singleuser">Search a Friend</div>
                <div class="options viewprofile">View Profile</div>
                <div class="options">About the developer</div>
                <div class="options logout">Logout</div>
            </div>
        </div>
    </div>
    <nav class="navbar bg-custom navbar-expand-xs fixed-top navbar-default">
        <div class="hamburger d-flex">
            <i class="fa fa-bars" aria-hidden="true"></i>
            <div class="brand">SnakApp</div>
        </div>
        
            <div class="headicons">
                <i class="fa fa-search align-self-center" aria-hidden="true"></i>
            </div>
    </nav>

    <!-- No chats section start -->
    {% if length == 0 %}
        <div class='chats text-center'>
            <div class="icon">
                <i class="fas fa-comment-slash"></i>
            </div>
            <div class="nofriends">
                No Chats!
            </div>
            <div class="search-div">
                <button class="search">Search</button>
                <button class="invite">Invite</button>
            </div>
            <div class="create">
                <button class="creategroup">Create New Group</button>
            </div>
        </div>
    <!-- No Chats section end -->
    {% else %}
    <div class="message-box">
    </div>
    {% endif %}
    <!-- 
        <div class="lasttime">
                8:09 pm
            </div>
            <div class="duemsg">
                <div class="pending text-center">3</div>
            </div>
     -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script>
        window.addEventListener( "pageshow", function ( event ) {
            var historyTraversal = event.persisted || 
                                    ( typeof window.performance != "undefined" && 
                                        window.performance.navigation.type === 2 );
            if ( historyTraversal ) {
                // Handle page restore.
                window.location.reload();
            }
        });
        var user = "{{username|escapejs}}"
        $('.fa-bars').click(function(){
            $('.sidebar').css({"width" : '77%'});
        })
        $('.greenbox').click(function(){
            window.location.pathname = '/main/profile/' + user + '/view/';
        })
        
        document.onclick = function(event){
            if (event===undefined) event= window.event;
            var target= 'target' in event? event.target : event.srcElement;
            if(target.className != 'sidebar' && target.className != 'hamburger d-flex' && target.className != 'fa fa-bars'){
                $('.sidebar').css({"width" : '0%'});
            }
        }
        $(".search").click(function(){
            window.location.pathname = '/main/search/username/';
        });
        $(".creategroup").click(function(){
            window.location.pathname = '/main/group/participants/';
        });
        $('.newgroup').click(function(){
            window.location.pathname = '/main/group/participants/';
        });
        $('.logout').click(function(){
            window.location.pathname = '/accounts/logout/';
        });
        $('.singleuser').click(function(){
            window.location.pathname = '/main/search/username/';
        });
        $('.fa-search').click(function(){
            window.location.pathname = '/main/search/username/';
        });
        $('.viewprofile').click(function(){
            window.location.pathname = '/main/profile/' + user + '/view/';
        });
    </script>
    <script>
        var chat = JSON.parse("{{chats|escapejs}}");
        var a = $('.message-box');
        var span;
        var g = 0;
        var u = 0;
        for(var i = 0; i < chat.length; i++){
            if(chat[i][2] === 0){
                a.append(
                    '<div class="messages d-flex"><span class="group-icon"></span><div class="group-data align-self-start"><div class="group-name">' + chat[i][0] + '</div><div class="lastmsg">' + chat[i][1] + '</div></div></div>'
                )
                var x = document.createElement("IMG");
                x.setAttribute("src", chat[i][3]);
                span = document.getElementsByClassName("group-icon")[g];
                span.appendChild(x);
                g = g + 1;
            }
            else if(chat[i][2] === 1){
                a.append(
                    '<div class="messages d-flex"><span class="group-icon"></span><div class="group-data align-self-start"><div class="group-name">' + chat[i][0] + '</div><div class="lastmsg">Photo</div></div></div>'
                )
                var x = document.createElement("IMG");
                x.setAttribute("src", chat[i][3]);
                span = document.getElementsByClassName("group-icon")[g];
                span.appendChild(x);
                g = g + 1;
            }
            else if(chat[i][2] == 2){
                a.append(
                    '<div class="messages d-flex"><span class="user-icon"></span><div class="user-data align-self-start"><div class="user-name">' + chat[i][0] + '</div><div class="lastmsg">' + chat[i][1] + '</div></div></div>'
                )
                var x = document.createElement("IMG");
                x.setAttribute("src", chat[i][3]);
                span = document.getElementsByClassName("user-icon")[u];
                span.appendChild(x);
                u = u + 1;
            }
            else if(chat[i][2] == 3){
                a.append(
                    '<div class="messages d-flex"><span class="user-icon"></span><div class="user-data align-self-start"><div class="user-name">' + chat[i][0] + '</div><div class="lastmsg">Photo</div></div></div>'
                )
                var x = document.createElement("IMG");
                x.setAttribute("src", chat[i][3]);
                span = document.getElementsByClassName("user-icon")[u];
                span.appendChild(x);
                u = u + 1;
            }
            
        }
        $('.user-data').click(function(){
            var name = $($(this).children($('.user-name'))[0]).text();
            console.log(name)
            window.location.pathname = '/main/personalchat/' + name + '/';
        });
        $('.group-data').click(function(){
            var groupname = $($(this).children($('.group-name'))[0]).text();
            console.log(groupname)
            window.location.pathname = '/groups/' + groupname + '/chats/';
        });
        $('.user-icon').click(function(){
            var name = $($($(this).parent().children($('.user-name'))[1]).children($('.user-name'))[0]).text();
            
            window.location.pathname = '/main/profile/' + name + '/view/';
        });
        $('.group-icon').click(function(){
            var name = $($($(this).parent().children($('.group-name'))[1]).children($('.group-name'))[0]).text();
            
            window.location.pathname = '/main/profile/' + name + '/view/';
        });
        
    </script>
</body>
</html>